server {
    listen 80;
    listen 443 default_server ssl;

    server_name {{ host_name }};

    ssl_certificate     /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;
    ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers         HIGH:!aNULL:!MD5;

    root         /home/vagrant/www/{{ host_name }};
    access_log   {{ log_dir }}/nginx.{{ host_name }}.access.log;
    error_log    {{ log_dir }}/nginx.{{ host_name }}.error.log;

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_index index.php;
        fastcgi_pass  unix:/var/run/php5-fpm.sock;
        include       fastcgi_params;
        fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;
        fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;
    }

    # Drupal rules
    #
    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }

    location / {
        # This is cool because no php is touched for static content
        try_files $uri @rewrite;
    }

    location @rewrite {
        # Some modules enforce no slash (/) at the end of the URL
        # Else this rewrite block wouldn't be needed (GlobalRedirect)
        rewrite ^/(.*)$ /index.php?q=$1;
    }

    # Catch image styles for D7 too.
    location ~ ^/sites/.*/files/styles/ {
        try_files $uri @rewrite;
        expires max;
        add_header Cache-Control public;
    }
}
